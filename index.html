<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>浮层拖动</title>
	<style type="text/css">
				
		.slide-wraper {
			position: absolute;
			top: 0;
			left: 0;
			z-index: 1;
			overflow: hidden;
			width: 100%;
			height: 100%;
			background-image: -webkit-linear-gradient(to bottom,#070607,#2e2e30);
			background-image: linear-gradient(to bottom,#070607,#2e2e30);
		}

		.background-img {
			position: absolute;
			top: 50%;
			left: 50%;
			z-index: 1;
			margin-top: -264px;
			margin-left: -600px;
			width: 1099px;
			height: 569px;
			background-image: url(images/fea-37.png);
			/* 如果浏览器支持image-set，在Retina屏下，会选择image-set中的@2x背景图像 */
			background-image: -webkit-image-set(url('./images/fea-37.png') 1x,url('./images/fea-37_2x.png') 2x);
			background-repeat: no-repeat;
		}

		.drag-bar {
			position: absolute;
			top: 50%;
			left: -30px;
			z-index: 16;
			display: none;
			width: 50px;
			height: 50px;
			background-color: hsla(0,0%,100%,.7);
			box-shadow: 0 0 5px 5px #fff;
			cursor: move;
			transform: rotate(45deg) skew(-20deg,-20deg);
		}

		.upper-mask {
			position: absolute;
			top: 0;
			right: 0;
			z-index: 10;
			overflow: hidden;
			width: 100%;
			height: 100%;
			background-color: #fff;
		}

		.mask-img {
			position: absolute;
			top: 50%;
			z-index: 11;
			margin-top: -261px;
			width: 1102px;
			height: 566px;
			background-image: url(images/fea-35.png);
			background-image: -webkit-image-set(url('./images/fea-35.png') 1x,url('./images/fea-35_2x.png') 2x);
			background-repeat: no-repeat;
		}

	</style>

</head>
<body>
	<div id="wraper" class="slide-wraper">
		<div class="background-img"></div>
		<div id="upper-mask" class="upper-mask">
			<div id="mask-img" class="mask-img"></div>
			<div id="drag-bar" class="drag-bar"></div>
		</div>
	</div>

	<script >
		(function() {

		// 拖动的图标
		var drag_bar = document.getElementById('drag-bar');
		// 浮动层
		var upper_mask = document.getElementById('upper-mask');
		// 浮动层图片
		var mask_img = document.getElementById('mask-img');
		// 暂不考虑resize事件后的变化
		var w_width = document.documentElement.clientWidth || document.body.clientWidth;

		// 固定浮动层图片位置
		mask_img.style.right = w_width / 2 - 1102 + 601 + 'px';

		var startX;

		function dragHandler(e) {
			e = e || event;
			startX = e.clientX
			// 图标点击后监听鼠标移动事件，即“拖动”
			document.addEventListener("mousemove", moveHandler, false);
			return false;
		}
		// 更新拖动的遮罩的宽度
		function moveHandler(e) {
			e = e || event;
			upper_mask.style.width = w_width - e.clientX + 'px';
		}

		function remove() {
			document.removeEventListener("mousemove", moveHandler, false);
		}

		drag_bar.addEventListener("mousedown", dragHandler, false);
		document.addEventListener("mouseup", remove, false);

		// 开头动画，分两步
		function anime(obj, end, fn) {
			obj.timer && clearInterval(obj.timer);

			obj.timer = setInterval(function() {
				// 获得遮罩的当前宽度，其实offsetwidth或clientwidth都行
				var current = parseInt(obj.currentStyle ? obj.currentStyle['width'] : getComputedStyle(obj, null)['width']);

				// 目标宽度与当前宽度，每步动画大小
				var speed = (end - current) / 10;
				speed = speed > 0 ? Math.ceil(speed) : Math.floor(speed);

				var stop = true;

				if (current !== end) {
					// 改变宽度
					obj.style.width = current + speed + 'px';
					stop = false;
				}

				if (stop) {
					// 终止动画并执行回调
					clearInterval(obj.timer);
					obj.timer = null;
					fn && fn();
				}

			}, 16);
		}

		setTimeout(function() {
			anime(upper_mask, 0, function() {
				// 回调的动画
				anime(upper_mask, w_width - 300, function() {
					// 回调的回调
					drag_bar.style.display = 'block';
				});
			});
		}, 800);

	})();

	</script>
</body>
</html>
